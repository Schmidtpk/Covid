df <- read.csv("./data-raw/kaggle italy/covid19_italy_region.csv")
dim(df)
ls(df)
library(tidyverse)
library(pmdplyr)

# data cleaning -----------------------------------------------------------

# date
df$Date <- as.Date(df$Date)

# unneccesary variables
df$Country <- NULL

# rename variables
df <- as_tibble(df)

df <- df %>%
  rename(
    region = RegionName,
    pos.new = NewPositiveCases,
    pos.total = TotalPositiveCases,
    pos.cur = CurrentPositiveCases,
  )

# make panel data frame pdata.frame
df$t <- df$Date-min(df$Date)
df <- pdata.frame(df,index = c("region","t"))


# compute important variables ---------------------------------------------
df$infected <- df$pos.total - lag(df$pos.total)
df$growth = log(df$infected)/log(lag(df$infected))

# add time dummies
# t <- factor(df$Date)
# dummies = model.matrix(~t)

# save for package --------------------------------------------------------
italy <- df
use_data(italy,overwrite = TRUE)

# add lombardia -----------------------------------------------------------
lombardia <- italy %>% filter(region=="Lombardia")
use_data(lombardia, overwrite = TRUE)

